<!DOCTYPE html>
<html lang="en">
<head>
   <%- include ('../partials/partial') %>
    <title>Login Page</title>

<style>
   body{
      background-color: whitesmoke;
      padding:0;
      margin:0;
   }
 .maindiv{
   display:flex;
   justify-content: center;
   margin-top:130px;
   box-sizing: border-box;
   width:100vw;
  }
 .innerdiv{
    background-color: white;
    box-shadow:0 0 10px lightgrey;
    border-radius:20px;
    padding:20px;
    overflow: hidden;
    position: fixed;
  }
 input{
    border:0;
    border-bottom: solid black 2px;
   width:100%;
 }
 input:focus{
   outline: none;
 }
 h1{
font-family: 'Lilita One', sans-serif;
font-family: 'Open Sans', sans-serif;
font-family: 'Poppins', sans-serif;
position: absolute;
top:20px;
 }
 i{
    font-size:20px;
    padding-right:10px;
 }
 a{
font-family: 'Lilita One', sans-serif;
font-family: 'Open Sans', sans-serif;
font-family: 'Poppins', sans-serif; 
 }
 #errormessage{
   
  justify-content: center;
  display:flex;
  box-shadow: 0px 0px 6px 1px red;
  font-weight:bold;
  visibility: hidden;

 }
 span{
  font-size:20px;
  font-family: 'Lilita One', sans-serif;
  font-family: 'Open Sans', sans-serif;
  font-family: 'Poppins', sans-serif;
  text-align:center;
  padding:5px;
  color:red;
  font-weight:bold;
  width:100%;
 }
 #closebutton{
  color:red;
  background-color: whitesmoke;
  margin-right:20px;
  border:0;
 }
 #closebutton:focus{
  outline: none;
 }


</style>   

</head>
<body>

   <div id="errormessage">
    
   </div>

    <div class="row maindiv">

    <div style="display:flex;" class="col-xs-8 col-sm-8 col-md-8 col-lg-8 col-xl-8 innerdiv">
    
    <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8 col-xl-8" >
      <img style= "position: relative;width:25%; left:10px; padding-bottom:20px;" src="../images/logo-nmims-prod.png" /></br>
      <img style= "position: relative;width:80%; left:10px;"  src="../images/login-animate-nmims.svg" />
    </div>
    
    <div style="position:relative;right:60px;" class="col-xs-8 col-sm-8 col-md-8 col-lg-8 col-xl-8" >
    <h1 style="width:20%;">Welcome</h1>
   
    <div style="margin-top:25%;" class="col-xs-8 col-sm-8 col-md-8 col-lg-8 col-xl-8" >
    
    <div>
    <i class="fi fi-rr-user" ></i><input name="username" id="user" style="margin-bottom:40px;width:66%;" placeholder="LoginId" type="text"/></br>
    <i class="fi fi-rr-lock" ></i><input name="password" id="pass" placeholder="Password" type="password" style="width:66%;"/></br>
    <a href="#" style="position:absolute; right:25%; font-size:18px; color:red; width:20%; text-decoration:none;" >Forgot?</a>
    <button style="padding:5px; font-weight:bold; border:0; border-radius:10px; background-color: red; color:white; width:70%; position:relative; overflow:hidden; left:30px; top:80px; " id="login" type="submit" >Login</button>
    </div>

    </div>
    
    </div>

    </div>
    </div>
   
</body>
<%- include ('../partials/partial2') %>
<script>

    //For Enter Button for Login
    document.getElementById('pass').addEventListener('keypress', function(event) {
      if (event.key === 'Enter'){
       
        let username = document.getElementById('user').value;
        let password = document.getElementById('pass').value;
     
        let obj = {username , password};

        validateUser('/elective/login','POST',obj)
        .then(responseData => {
            loginMessage(responseData);
        });
      }
    });

    document.getElementById('login').addEventListener('click',async () => {
     let username = document.getElementById('user').value;
     let password = document.getElementById('pass').value;
     
     let obj = {username , password};

     validateUser('/elective/login','POST',obj)
     .then(responseData => {
        loginMessage(responseData); 
     });

    });

     async function validateUser(url,method,obj){
      return new Promise((resolve,reject) => {

      let requestDetails ={
      method : method ,
      headers : {
        'Content-Type':'application/json'
      },
      body: JSON.stringify(obj) || undefined,
      } 

      fetch(url,requestDetails)
      .then(response => {
        if(response.ok){
          return response.json();
        }
       throw new Error('Error in Response'); 
      })
      .then(data => {
       resolve(data);
      })
      .catch(error => {
       reject(error);
      })

    });
     }

    async function loginMessage(response){
      if(response.status === 'success'){
        window.location.href = response.redirectTo;
      }else{
        let displayMessage = document.getElementById('errormessage');
        displayMessage.innerHTML = `<span>${response.message}</span>
        <button class="fa fa-close" id= "closebutton" style="font-size:24px" ></button>`;

        await closeButton();
        displayMessage.style.color = 'red';
        displayMessage.style.visibility = 'visible';
      }
     }

    errormessage();
    
    //Displaying Error Message
    async function errormessage(){
    let displayMessage = document.getElementById('errormessage');

    if(window.location.hash === '#sessionTimeout'){
      displayMessage.innerHTML = `<span>Oops Session Timeout, Please Login Again!!</span>
      <button class="fa fa-close" id= "closebutton" style="font-size:24px" ></button>`;

      displayMessage.style.color = 'red';
      displayMessage.style.visibility = "visible";
     closeButton();
    }
   
   

    }

    //Hiding Error Message
    function closeButton(){

    document.getElementById('closebutton')?.addEventListener('click',() =>{
    let displayMessage = document.getElementById('errormessage');
    let path = window.location.pathname;
    window.location.href = path
    displayMessage.style.visibility = "hidden";

    });

    }
   


    

  

</script>
</html>